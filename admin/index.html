<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>
<body>

<h2>Admin Panel</h2>
<button onclick="logout()">Logout</button>

<form id="news-form">
  <input id="news-title" placeholder="Title"><br><br>
  <textarea id="news-desc" placeholder="Description"></textarea><br><br>
  <input id="news-image" placeholder="image/news1.jpg"><br><br>
  <button type="submit">Add News</button>
</form>

<hr>
<div id="news-list"></div>

<script>
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "chhabalal-31cea.firebaseapp.com",
    projectId: "chhabalal-31cea"
  };

  firebase.initializeApp(firebaseConfig);

  const db = firebase.firestore();
  const form = document.getElementById("news-form");
  const newsList = document.getElementById("news-list");
  const BASE_URL = "https://chhablala7-arch.github.io/my-news-website/";

  // ðŸ” Auth check
  firebase.auth().onAuthStateChanged(user => {
    if (!user) {
      alert("âŒ Login required");
      window.location.href = "login.html";
    }
  });

  function logout() {
    firebase.auth().signOut();
  }

  function renderNews() {
    newsList.innerHTML = "";
    db.collection("news").orderBy("date", "desc").get()
      .then(snapshot => {
        snapshot.forEach(doc => {
          const d = doc.data();
          const img = d.image ? `<img src="${BASE_URL}${d.image}" width="150">` : "";

          newsList.innerHTML += `
            <h3>${d.title}</h3>
            ${img}
            <p>${d.description}</p>
            <button onclick="deleteNews('${doc.id}')">Delete</button>
            <hr>
          `;
        });
      });
  }

  function deleteNews(id) {
    db.collection("news").doc(id).delete().then(renderNews);
  }

  form.addEventListener("submit", e => {
    e.preventDefault();

    db.collection("news").add({
      title: news-title.value,
      description: news-desc.value,
      image: news-image.value,
      date: firebase.firestore.FieldValue.serverTimestamp()
    })
    .then(() => {
      form.reset();
      renderNews();
      alert("âœ… News Added");
    })
    .catch(err => alert(err.message));
  });

  renderNews();
</script>

</body>
</html>

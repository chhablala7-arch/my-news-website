<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<style>
body{font-family:Arial;background:#f4f4f4;padding:20px;}
input,textarea,button{width:100%;padding:10px;margin:8px 0;font-size:16px;}
button{background:#667eea;color:#fff;border:none;border-radius:6px;cursor:pointer;}
button:hover{opacity:0.9;}
.msg{margin-top:10px;color:green;min-height:18px;}
.news{border-bottom:1px solid #ccc;padding:8px;margin-bottom:10px;}
.del{background:#e74c3c;color:#fff;border:none;padding:5px 10px;cursor:pointer;border-radius:5px;}
</style>
</head>
<body>

<h2>Admin Dashboard</h2>

<!-- Add News Form -->
<div>
<input type="text" id="title" placeholder="News Title">
<textarea id="desc" placeholder="News Description"></textarea>
<button onclick="addNews()">Add News</button>
<p class="msg" id="msg"></p>
</div>

<!-- News List -->
<h3>All News</h3>
<div id="newsList"></div>

<button onclick="logout()">Logout</button>

<script src="firebase.js"></script>
<script>
// Protect Admin
auth.onAuthStateChanged(user=>{
  if(!user) window.location.href="login.html";
});

// Add News
function addNews(){
  const title = document.getElementById("title").value.trim();
  const desc = document.getElementById("desc").value.trim();
  const msg = document.getElementById("msg");

  if(!title || !desc){
    msg.style.color="red";
    msg.innerText="Title और Description दोनों जरूरी हैं";
    return;
  }

  console.log("Button clicked"); // debug

  db.collection("news").add({
    title: title,
    description: desc,
    image: "", // No image
    date: firebase.firestore.FieldValue.serverTimestamp()
  }).then(()=>{
    msg.style.color="green";
    msg.innerText="✅ News Added Successfully";
    document.getElementById("title").value="";
    document.getElementById("desc").value="";
  }).catch(e=>{
    msg.style.color="red";
    msg.innerText=e.message;
  });
}

// Load all news
function loadNews(){
  db.collection("news").orderBy("date","desc")
  .onSnapshot(snapshot=>{
    const newsList = document.getElementById("newsList");
    newsList.innerHTML="";
    snapshot.forEach(doc=>{
      const d = doc.data();
      newsList.innerHTML += `
      <div class="news">
        <h4>${d.title}</h4>
        <p>${d.description}</p>
        <button class="del" onclick="deleteNews('${doc.id}')">Delete</button>
      </div>`;
    });
  });
}

// Delete News
function deleteNews(id){
  db.collection("news").doc(id).delete();
}

// Logout
function logout(){
  auth.signOut().then(()=> window.location.href="login.html");
}

// Initial load
loadNews();
</script>

</body>
</html>
